<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>WebSocket Test</title>
  <script>
    let socket;

    document.addEventListener('DOMContentLoaded', (event) => {
      socket = new WebSocket('ws://localhost:9000/7bd8ae5b00fa78df');

      socket.onopen = function (e) {
        console.log("连接服务器成功");
      };

      socket.onmessage = function (event) {
        event.data.text().then(text => {
          document.getElementById('messages').innerHTML += `<p>${text}</p>`;
        });
      };

      socket.onclose = function (event) {
        if (event.wasClean) {
          console.log(`[关闭]: Connection closed cleanly, code=${event.code} reason=${event.reason}`);
        } else {
          // e.g. server process killed or network down
          console.log('[关闭]: Connection died');
        }
      };

      socket.onerror = function (error) {
        console.log(`[错误]: ${error.message}`);
      };
    });

    function sendMessage() {
      var message = document.getElementById('messageInput').value;
      socket.send(message);
      document.getElementById('messageInput').value = '';
    }

  </script>
</head>

<body>
  <input type="text" id="messageInput" placeholder="输入消息">
  <button onclick="sendMessage()">发送</button>
  <div id="messages"></div>
  <form id="uploadForm">
    <input type="file" name="file" />
    <button type="submit">上传文件</button>
  </form>

</body>
<script>
  document.getElementById('uploadForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const formData = new FormData();
    const fileInput = document.querySelector('input[type="file"]');

    if (fileInput.files.length > 0) {
      formData.append('file', fileInput.files[0]);

      fetch('http://localhost:8000/message/import?roomId=a6f178071408076a', {
        method: 'POST',
        body: formData
      })
        .then(response => response.json())
        .then(data => console.log(data))
        .catch(error => console.error('Error:', error));
    } else {
      console.log('No file selected.');
    }
  });

</script>

</html>